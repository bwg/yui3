YUI.add("menu",function(e,t){var n=e.ClassNameManager.getClassName,r="itemClick",i=e.Base.create("menu",e.Menu.Base,[e.View],{classNames:{canHaveChildren:n("menu-can-have-children"),children:n("menu-children"),disabled:n("menu-disabled"),hasChildren:n("menu-has-children"),heading:n("menu-heading"),item:n("menu-item"),label:n("menu-label"),menu:n("menu"),noTouch:n("menu-notouch"),open:n("menu-open"),selected:n("menu-selected"),separator:n("menu-separator"),touch:n("menu-touch")},rendered:!1,initializer:function(){this._openMenus={},this._published={},this._timeouts={},this._attachMenuEvents()},destructor:function(){this._detachMenuEvents(),delete this._openMenus,delete this._published,e.Object.each(this._timeouts,function(e){clearTimeout(e)},this),delete this._timeouts},closeSubMenus:function(){return e.Object.each(this._openMenus,function(e){e.close()},this),this},getHTMLNode:function(e){return e._htmlNode||(e._htmlNode=this.get("container").one("#"+e.id)),e._htmlNode},hide:function(){return this.set("visible",!1),this},render:function(){var t=this.get("container");return t.addClass(this.classNames.menu),"ontouchstart"in e.config.win?t.addClass(this.classNames.touch):t.addClass(this.classNames.noTouch),this._childrenNode=this.renderChildren(this.rootNode,{container:t}),t.inDoc()||e.one("body").append(t),this.rendered=!0,this},renderChildren:function(t,n){n||(n={});var r=n.container,s=r&&r.one("."+this.classNames.children);s||(s=e.Node.create(i.Templates.children({classNames:this.classNames,menu:this,item:t}))),t.isRoot()&&(s.set("tabIndex",0),s.set("role","menu")),t.hasChildren()&&s.set("aria-expanded",t.isOpen());for(var o=0,u=t.children.length;o<u;o++)this.renderNode(t.children[o],{container:s,renderChildren:!0});return r&&r.append(s),s},renderNode:function(t,n){n||(n={});var r=this.classNames,s=t._htmlNode;s||(s=t._htmlNode=e.Node.create(i.Templates.item({classNames:r,item:t,menu:this})));switch(t.type){case"separator":s.set("role","separator");break;case"item":case"heading":var o=s.one("."+r.label),u=o.get("id");o.setHTML(t.label),u||(u=e.guid(),o.set("id",u)),s.set("aria-labelledby",u),t.type==="heading"?s.set("role","heading"):(s.set("role","menuitem"),s.toggleClass(r.disabled,t.isDisabled()),t.canHaveChildren&&(s.addClass(r.canHaveChildren),s.toggleClass(r.open,t.isOpen()),t.hasChildren()&&(s.addClass(r.hasChildren),n.renderChildren&&this.renderChildren(t,{container:s}))))}return n.container&&n.container.append(s),s},show:function(){return this.set("visible",!0),this},toggle:function(){return this.set("visible",!this.get("visible")),this},_attachMenuEvents:function(){this._menuEvents||(this._menuEvents=[]);var e=this.classNames,t=this.get("container");this._menuEvents.push(this.after({add:this._afterAdd,clear:this._afterClear,close:this._afterClose,open:this._afterOpen,remove:this._afterRemove,visibleChange:this._afterVisibleChange}),t.on("hover",this._onMenuMouseEnter,this._onMenuMouseLeave,this),t.delegate("click",this._onItemClick,"."+e.item+">."+e.label,this),t.delegate("hover",this._onItemMouseEnter,this._onItemMouseLeave,"."+e.canHaveChildren,this),t.after("clickoutside",this._afterClickOutside,this))},_detachMenuEvents:function(){(new e.EventHandle(this._menuEvents)).detach()},_getAnchorRegion:function(e,t,n){switch(e){case"tl-tr":return{bottom:n.top+t.height,left:n.right,right:n.right+t.width,top:n.top};case"bl-br":return{bottom:n.bottom,left:n.right,right:n.right+t.width,top:n.bottom-t.height};case"tr-tl":return{bottom:n.top+t.height,left:n.left-t.width,right:n.left,top:n.top};case"br-bl":return{bottom:n.bottom,left:n.left-t.width,right:n.left,top:n.bottom-t.height}}},_hideMenu:function(e,t){t||(t=this.getHTMLNode(e));var n=t.one("."+this.classNames.children);n.setXY([-1e4,-1e4]),delete e.data.menuAnchor},_inRegion:function(e,t){return e.bottom<=t.bottom&&e.left>=t.left&&e.right<=t.right&&e.top>=t.top?!0:Math.min(t.bottom-e.bottom,0)+Math.min(e.left-t.left,0)+Math.min(t.right-e.right,0)+Math.min(e.top-t.top,0)},_positionMenu:function(e,t){t||(t=this.getHTMLNode(e));var n=e.parent&&e.parent.data.menuAnchors||[{point:"tl-tr"},{point:"bl-br"},{point:"tr-tl"},{point:"br-bl"}],r=t.one("."+this.classNames.children),i=r.get("region"),s=t.get("region"),o=t.get("viewportRegion"),u;for(var a=0,f=n.length;a<f;a++)u=n[a],u.region=this._getAnchorRegion(u.point,i,s),u.score=this._inRegion(u.region,o);n.sort(function(e,t){return e.score===t.score?0:e.score===!0?-1:t.score===!0?1:t.score-e.score}),e.data.menuAnchors=n;var l=n[0].region;r.setXY([l.left,l.top])},_afterAdd:function(e){if(!this.rendered)return;var t=e.parent,n,r;if(t===this.rootNode)n=this._childrenNode;else{r=this.getHTMLNode(t),n=r&&r.one("."+this.classNames.children);if(!n){r||(r=this.renderNode(t)),this.renderChildren(t,{container:r});return}}n.insert(this.renderNode(e.node,{renderChildren:!0}),e.index)},_afterClear:function(){this._openMenus={};if(!this.rendered)return;delete this._childrenNode,this.rendered=!1,this.get("container").empty(),this.render()},_afterClickOutside:function(){this.closeSubMenus()},_afterClose:function(e){var t=e.node,n=this.getHTMLNode(t);for(var r=0,i=t.children.length;r<i;r++)t.children[r].close();t.close(),delete this._openMenus[t.id],n&&(this._hideMenu(t,n),n.removeClass(this.classNames.open))},_afterOpen:function(e){var t=e.node,n=this.getHTMLNode(t),r=t.parent,i;if(r)if(r.isOpen())for(var s=0,o=r.children.length;s<o;s++)i=r.children[s],i!==t&&i.close();else r.open();this._openMenus[t.id]=t,n&&(this._positionMenu(t,n),n.addClass(this.classNames.open))},_afterRemove:function(e){delete this._openMenus[e.node.id];if(!this.rendered)return;var t=this.getHTMLNode(e.node);t&&(t.remove(!0),delete e.node._htmlNode)},_afterVisibleChange:function(e){this.get("container").toggleClass(this.classNames.open,e.newVal)},_onItemClick:function(e){var t=this.getNodeById(e.currentTarget.getData("item-id")),n=t.isDisabled();(n||t.url==="#")&&e._event.preventDefault();if(n)return;this._published[r]||(this._published[r]=this.publish(r,{defaultFn:this._defClickFn})),this.fire(r,{originEvent:e,item:t})},_onItemMouseEnter:function(e){var t=this.getNodeById(e.currentTarget.get("id")),n=this;clearTimeout(this._timeouts.item);if(t.isOpen())return;this._timeouts.item=setTimeout(function(){t.open()},200)},_onItemMouseLeave:function(e){var t=this.getNodeById(e.currentTarget.get("id")),n=this;clearTimeout(this._timeouts.item);if(!t.isOpen())return;this._timeouts.item=setTimeout(function(){t.close()},300)},_onMenuMouseEnter:function(){clearTimeout(this._timeouts.menu)},_onMenuMouseLeave:function(){var e=this;clearTimeout(this._timeouts.menu),this._timeouts.menu=setTimeout(function(){e.closeSubMenus()},500)},_defClickFn:function(e){var t=e.item;t.canHaveChildren?(clearTimeout(this._timeouts.item),clearTimeout(this._timeouts.menu),e.item.toggle()):this.closeSubMenus()}},{ATTRS:{visible:{value:!1}}});e.Menu=e.mix(i,e.Menu)},"@VERSION@",{requires:["classnamemanager","event-hover","event-outside","menu-base","menu-templates","node-screen","view"],skinnable:!0});
