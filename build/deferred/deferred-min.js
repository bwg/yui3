YUI.add("deferred",function(g,d){var f=[].slice,a=g.Lang.isArray,e=g.Lang.isFunction;function b(){this._subs={resolve:[],reject:[]};this._promise=new g.Promise(this);this._status="in progress";}g.mix(b.prototype,{promise:function(){return this._promise;},resolve:function(){this._result=f.call(arguments);this._notify(this._subs.resolve,this.promise(),this._result);this._subs={resolve:[]};this._status="resolved";return this;},reject:function(){this._result=f.call(arguments);this._notify(this._subs.reject,this.promise(),this._result);this._subs={reject:[]};this._status="rejected";return this;},then:function(n,i){var m=new g.Deferred(),l=this.promise(),j=this._subs.resolve||[],h=this._subs.reject||[];function k(o){return function(){var p=f.call(arguments);(g.soon||setTimeout)(function(){var r=o.apply(l,p),q;if(r&&typeof r.promise==="function"){q=r.promise();r=q.getResult();switch(q.getStatus()){case"in progress":q.then(g.bind(m.resolve,m),g.bind(m.reject,m));break;case"resolved":m.resolve.apply(m,r);break;case"rejected":m.reject.apply(m,r);break;}}else{m.resolve.apply(m,(a(r)?r:[r]));}},0);};}j.push((typeof n==="function")?k(n,"resolve"):g.bind("resolve",m));h.push((typeof i==="function")?k(i,"reject"):g.bind("reject",m));if(this._status==="resolved"){this.resolve.apply(this,this._result);}else{if(this._status==="rejected"){this.reject.apply(this,this._result);}}j=h=null;return m.promise();},getStatus:function(){return this._status;},getResult:function(){return this._result;},_notify:function(m,l,j){var k,h;if(m){for(k=0,h=m.length;k<h;++k){m[k].apply(l,j);}}}},true);g.Deferred=b;g.defer=function(i){var h=new g.Deferred();(g.soon||setTimeout)(function(){if(e(i)){i(h);}else{h.resolve(i);}},0);return h.promise();};g.when=function(j,k,h){var i;if(!e(j.then)){i=j;j=g.defer(function(l){l.resolve(i);});}return(k||h)?j.then(k,h):j;};function c(h){this._deferred=h;}c.addMethod=function(h){if(!a(h)){h=[h];}g.Array.each(h,function(i){c.prototype[i]=function(){return this._deferred[i].apply(this._deferred,arguments);};});};c.addMethod(["then","promise","getStatus","getResult"]);g.Promise=c;},"@VERSION@",{"requires":["oop"]});